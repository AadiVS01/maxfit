generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql" 
  url      = env("DATABASE_URL")
}

// USERS
model User {
  id        Int           @id @default(autoincrement())
  name      String?
  email     String        @unique
  outfits   Outfit[]      
  usages    OutfitUsage[]

  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
}

// OUTFITS
model Outfit {
  id          Int                   @id @default(autoincrement())
  name        String
  imageUrl    String?  
  description String?

  // Many-to-many relations
  tops        Top[]          @relation("OutfitTops")
  bottoms     Bottom[]       @relation("OutfitBottoms")
  onepieces   OnePiece[]     @relation("OutfitOnePieces")
  footwear    Footwear[]     @relation("OutfitFootwears")
  accessories Accessory[]    @relation("OutfitAccessories")

  // Embedding for AI search (optional)
  embedding   Float[]

  tags             Tag[]             @relation("OutfitTags")
  weatherConditions WeatherCondition[] @relation("OutfitWeather")
  outfitUsages      OutfitUsage[]

  userId    Int
  user      User @relation(fields: [userId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([name])
}

// CLOTHING PIECES
model Top {
  id        Int      @id @default(autoincrement())
  name      String
  color     String?
  imageUrl  String?
  embedding Float[]

  outfits   Outfit[] @relation("OutfitTops")
}

model Bottom {
  id        Int      @id @default(autoincrement())
  name      String
  color     String?
  imageUrl  String?
  embedding Float[]

  outfits   Outfit[] @relation("OutfitBottoms")
}

model OnePiece {
  id        Int      @id @default(autoincrement())
  name      String
  color     String?
  imageUrl  String?
  embedding Float[]

  outfits   Outfit[] @relation("OutfitOnePieces")
}

model Footwear {
  id        Int      @id @default(autoincrement())
  name      String
  color     String?
  imageUrl  String?
  embedding Float[]

  outfits   Outfit[] @relation("OutfitFootwears")
}

model Accessory {
  id        Int      @id @default(autoincrement())
  name      String
  color     String?
  imageUrl  String?
  embedding Float[]

  outfits   Outfit[] @relation("OutfitAccessories")
}

// TAGS & WEATHER
model Tag {
  id      Int      @id @default(autoincrement())
  name    String   @unique
  outfits Outfit[] @relation("OutfitTags")
}

model WeatherCondition {
  id      Int      @id @default(autoincrement())
  type    String
  outfits Outfit[] @relation("OutfitWeather")
}

// OUTFIT USAGE PER USER
model OutfitUsage {
  id        Int      @id @default(autoincrement())
  outfitId  Int
  outfit    Outfit   @relation(fields: [outfitId], references: [id])

  userId    Int
  user      User     @relation(fields: [userId], references: [id])

  usedAt    DateTime @default(now())
  context   String?  // e.g., "Date Night", "Work"

  @@unique([outfitId, userId, usedAt])
}
